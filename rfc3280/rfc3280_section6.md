## 6. Certification Path Validation   

인터넷 PKI에 대한 인증 경로 검증 절차는 [X.509]에서 제공한 알고리즘에 기초한다. 인증 경로 처리는 주체 식별 이름 및/또는 주체 대체 이름과 주체 공개 키 간의 바인딩을 확인한다. 바인딩은 경로를 구성하는 인증서에 지정된 제약 조건과 종속 당사자가 지정한 입력에 의해 제한된다. 기본 제약 조건 및 정책 제약 조건 확장은 인증 경로 처리 논리를 통한 의사 결정 프로세스 자동화를 가능하게 한다. 

이 section에서는 인증 경로를 검증하는 알고리즘을 설명한다. 이 사양의 구현은 이 알고리즘을 구현하지 않아도 되지만, 이 절차로 인해 발생하는 외부 동작과 동일한 기능을 제공해야 한다. 올바른 결과를 도출하는 모든 알고리즘은 특정 구현에서 사용할 수 있다. 

Section 6.1에서는 기본 경로 검증을 설명한다. 유효한 경로는 신뢰가능한 앵커가 발급하는 인증서로 시작한다. 이 알고리즘은 CA의 공개키, 이름 및 이 키를 사용하여 검증될 수 있는 경로 집합에 대한 제약조건을 필요로 한다.

신뢰가능한 앵커의 선택은 정책의 고려사항이다: PKI계층의 최상위 CA; 검증자의 자체 인증서를 발급한 CA; 또는 PKI 네트워크의 또 다른 CA가 될 수 있다. 경로 검증 절차는 신뢰가능한 앵커의 선택과 무관하게 동일하다. 또한 서로 다른 응용프로그램은 다른 신뢰 앵커에 의존하거나 서로 다른 신뢰 앵커 집합으로 시작하는 경로를 허용할 수 있다.

Section 6.2에서는 특정 구현에서 경로 유효성 검사 알고리즘을 사용하는 방법을 설명한다. 두 가지 구체적인 방법이 의논된다: 여러 신뢰할 수 있는 CA 중 하나로 경로가 시작할 수 있는 경우; PEM 아키텍처와의 호환성이 필요한 경우.

Section 6.3에서는 CRL이 인증서 발급자가 사용하는 해지 메커니즘인 경우 인증서가 해지되었는지 또는 보류 상태인지 결정하는 데 필요한 단계를 설명한다.

### 6.1. Basic Path Validation    

이 문서에서는 X.509 경로 처리 알고리즘에 대해 설명한다. 적합한  구현에는 이 알고리즘의 외부 동작과 기능적으로 동일한 X.509 경로 처리 절차가 포함되어야 한다. 그러나 이 알고리즘에서 처리되는 인증서 확장에 대한 지원은 호환 구현의 경우 선택 사항이다.  클라이언트는 지원하지 않는 확장에 대해 경로 유효성 검사 알고리즘에서 해당 단계를 생략할 수 있다. 예를 들면, 클라이언트는 정책 매핑 확장을 지원할 필요가 없다. 이 확장을 지원하지 않는 클라이언트는 정책 매핑이 처리되는 경로 유효성 검사 단계를 생략할 수 있다. 기억해야 할 점은, 지원되지 않는 중요한 확장이 포함된 경우 클라이언트는 인증서를 거부해야 한다는 것이다.

이 섹션에 제시된 알고리즘은 현재 날짜 및 시간에 대해 인증서를 검증한다. 이 명세에 적합한 구현은 과거의 어느 지점에 대한 유효성 검사 또한 지원할 수 있다. 인증서 유효 기간을 벗어난 시간에 대해서는 인증서를 검증하는 메커니즘을 사용할 수 없다.

신뢰가능한 앵커는 알고리즘의 입력값(input)이다. 모든 인증 경로의 유효성을 확인하는 데 동일한 신뢰 앵커를 사용할 필요는 없다. 섹션 6.2에서 자세히 설명한 바와 같이, 서로 다른 경로를 검증하기 위해 서로 다른 신뢰 앵커를 사용할 수 있다.

경로 검증의 주요한 목표는 <b>신뢰가능한 앵커(노드)의 공개 키를 기반으로 end entity 인증서에 표시된 것처럼 주체 고유 이름(subject distinguished name) 또는 주체 대체 이름(subject alternative name)과 주체 공개 키 간의 바인딩을 확인</b>하는 것이다. 이 작업을 수행하려면 해당 바인딩을 지원하는 일련의 인증서를 받아야 한다. 이 인증서 시퀀스를 얻기 위해 수행되는 절차는 이 규격의 범위를 벗어납니다.

이 목표를 달성하기 위해 경로 검증 프로세스는 예상 인증 경로 (n 개의 인증서 시퀀스)가 다음 조건을 충족하는지 확인한다:   
1. { 1, 2, ..., n-1 }의 모든 원소 x에 대해, 인증서 x의 주체가 인증서 x+1의 발행자
2. 인증서1은 신뢰가능한 앵커(root)에 의해 발행됨
3. 인증서n은 검증할 인증서
4. { 1, 2, ..., n }의 모든 원소 x에 대해, 인증서는 문제의 시간에 유효

신뢰가능한 앵커가 자체 서명 인증서의 형태로 제공되는 경우, 이 자체 서명 인증서는 예상 인증 경로의 일부로 포함되지 않는다. 신뢰 가능한 앵커에 대한 정보는 인증 경로 검증 알고리즘의 입력값으로 제공된다(section 6.1.1). `→trust anchor(RootCA)는 인증서를 자체 발급한다. 따라서 RootCA의 자체 발급 형태 인증서는 검증 대상에서 제외된다.`

그러나 특정 인증 경로가 모든 애플리케이션에 적합하지 않을 수 있다. 따라서 응용프로그램은 이 알고리즘을 확장하여 유효한 경로 집합을 추가로 제한할 수 있다. 또한 경로 유효성 검사 절차는 인증서 정책 확장, 정책 매핑 확장, 정책 제약 조건 확장 및 금지 정책 확장에 따라 이 경로에 유효한 인증서 정책 집합을 결정한다. 이를 위해 `경로 유효성 검사 알고리즘은 유효한 정책 트리를 구성`한다. 이 경로에 유효한 인증서 정책 집합이 비어 있지 않으면 n개의 유효한 정책 트리가 되고, 그렇지 않으면 유효한 정책 트리는 null이 된다.

주체 및 발급자 필드에 나타나는 DN이 동일하고 비어 있지 않으면 인증서가 자체 발급된 것이다. 일반적으로 경로를 구성하는 인증서의 발급자와 주체는 인증서마다 다르다. 그러나 CA는 인증서 정책의 주요 롤오버 또는 변경을 지원하기 위해 자체적으로 인증서를 발급할 수 있다. 자체 발급 인증서는 경로 길이 또는 이름 제약 조건을 평가할 때 계산되지 않는다.

본 section은 알고리즘을 네 개의 기본 단계로 나타낸다:
1. 초기화
2. 기본 인증서 처리
3. 다음 인증서 준비 
4. 마무리   

위 절차 중 (1)과 (4)는 정확하게 한번 수행된다. 절차(2)는 경로 내 모든 인증서에서 수행된다. 절차(3)은 절차 내 최종 마지막 인증서를 제외한 모든 인증서에서 수행된다. 

#### 6.1.1 Inputs   

이 알고리즘은 경로 검증 로직에 하기의 7가지 입력값이 제공됨을 가정한다:   
1. 길이 n의 예상 인증 경로
2. 현재 날짜/시간
3. 사용자 초기 정책 집합 : 인증서 사용자가 사용할 수 있는 정책의 이름을 지정하는 인증서 정책 식별자 집합. 사용자 초기 정책 집합은 사용자가 인증서 정책을 고려하지 않는 경우 특별 값인 any-policy를 포함한다.
4. 신뢰가능한 앵커 정보 : 인증 경로에 대한 신뢰가능한 앵커 역할의 CA를 설명.    
신뢰가능한 앵커 정보가 포함하는 항목  :    
    - 신뢰할 수 있는 발행자 이름
    - 신뢰할 수 있는 공개키 알고리즘
    - 신뢰할 수 있는 공개키
    - (선택) 공개키와 연관된 신뢰할 수 있는 공개 키 파라미터   

    신뢰가능한 앵커 정보는 자체 서명된 인증서의 형태로 경로 처리 절차에 제공될 수 있다. 신뢰가능한 앵커 정보는 신뢰할 수 있는 대역 외 절차에 의해 경로 처리 절차로 전달 되었기 때문에 신뢰할 수 있다. 신뢰할 수 있는 공개 키 알고리즘에 매개 변수가 필요한 경우 매개 변수가 신뢰할 수 있는 공개 키와 함께 제공된다.

5. 초기 정책 매핑 금지 : 정책 매핑이 인증 경로에서 허용되는지 여부
6. 초기 명시적 정책 : 사용자 초기 정책 집합에서 최소 하나 이상의 인증서 정책 중 적어도 하나에 대해 경로가 유효해야 하는지 여부
7. 초기 모든 정책 금지 : anyPolicy OID가 인증서에 포함 될 경우 처리 여부

 #### 6.1.2 Initialization   

 이 초기화 단계는 7개의 입력을 기반으로 11개의 상태 변수를 설정한다:

 1. valid_policy_tree    
 선택적 한정자가 포함된 인증서 정책 트리; 트리의 각 leaf 노드는 인증 경로 유효성 검사의 이 단계에서 유효한 정책을 나타낸다. 이 단계에서 인증 경로 검증에 유효한 정책이 존재하는 경우, 트리의 depth는 처리된 체인의 인증서 수와 같다. 이 단계에서 인증 경로 유효성 검사에 유효한 정책이 없으면 트리가 NULL로 설정된다. 트리가 NULL로 설정되면 정책 처리가 중지된다. 

    valid_policy_tree의 각 노드는 네가지 데이터 값을 포함한다: 유효 정책, 연관된 정책 확장자 집합, 하나 이상의 예상 정책 값 집합, 및 중요도 표시자. depth가 x인 노드의 구성 요소에는 아래와 같은 의미를 갖는다:

    - valid_policy    
    길이 x의 경로에 대한 유효한 정책을 나타내는 단일 정책 OID
    - qualifier_set   
    인증서 x의 유효한 정책과 연결된 정책 한정자 집합
    - expected_policy_set 
    인증서 x+1에서 이 정책을 충족하는 하나 이상의 정책 OID
    - criticality_indicator   
    인증서 x의 인증서 정책 확장이 중요함으로 표시되었는지 여부

    valid_policy_tree의 초기값은 {anyPolicy 값의 싱글 노드(valid_policy), empty(qualifier_set), anyPolicy의 싱글 노드(expected_policy_set), FALSE(critically_indicator)}으로 설정된다. 이 노드는 깊이 0에 있는 것으로 간주된다.

    그림 3은 valid_policy_tree의 초기 상태를 그래픽으로 표현한 것이다. 추가 그림은 경로 처리 중 valid_policy_tree의 변경 사항을 설명하기 위해 이 형식을 사용한다.   
    - Figure3. valid_policy_tree 상태변수의 초기값
    ```
     +----------------+
     |   anyPolicy    |   <---- valid_policy
     +----------------+
     |       {}       |   <---- qualifier_set
     +----------------+
     |     FALSE      |   <---- criticality_indicator
     +----------------+
     |  {anyPolicy}   |   <---- expected_policy_set
     +----------------+
     ```

2. permitted_subtrees   
인증 경로에 있는 후속 인증서의 모든 주체 이름을 포함하는 하위 트리 집합을 정의하는 각 이름 유형(예: X.500 고유 이름, 전자 메일 주소 또는 IP 주소)에 대한 루트 이름 집합. 이 변수에는 각 이름 유형에 대한 집합이 포함된다: DN 집합의 초기 값은 모든 DN을 포함하는 집합; RFC822 이름 집합의 초기 값은 모든 RFC822 이름 집합 등.

3. excluded_subtrees   
인증 경로에 있는 후속 인증서의 주체 이름이 포함되지 않을 수 있는 하위 트리 집합을 정의하는 각 이름 유형(예: X.500 고유 이름, 전자 메일 주소 또는 IP 주소)에 대한 루트 이름 집합. 이 변수는 각 이름 유형에 대한 집합을 포함하며, 각 집합의 초기 값은 비어 있다.

4. explicit_policy 
non-NULL인 valid_policy_tree 필요 여부 나타내는 정수. 이 값은 이 요구 사항이 적용되기 전에 처리할 자체 발급되지 않은 인증서의 수를 나타낸다. 일단 설정되면 이 변수는 감소할 수 있지만 증가할 수는 없다. 즉, 경로의 인증서가 non-NULL valid_policy_tree를 요구하는 경우 이후 인증서에서는 이 요구 사항을 제거할 수 없다. initial-explicit-policy가 설정된 경우 초기 값은 0이고, 그렇지 않은 경우 초기 값은 n+1이다.

5. inhibit_anyPolicy   
anyPolicy 정책 식별자가 일치하는지 여부를 나타내는 정수. 이 값은 인증서에 표시된 정책 OID가 무시되기 전에 처리할 자체 발급되지 않은 인증서의 수. 일단 설정되면이 변수는 감소 될 수 있지만 증가되지 않는다. 즉, 경로의 인증서가 anyPolicy 정책의 처리를 금지하는 경우 이후의 인증서는 이를 허용할 수 없다. initial-any-policy-inhibit이 설정된 경우 초기 값은 0이고, 그렇지 않은 경우 초기 값은 n+1이다.

6. policy_mapping   
policy_mapping 허용 여부 나타내는 정수. 이 값은 정책 매핑이 금지되기 전에 처리할 자체 발급되지 않은 인증서 수를 나타낸다. 일단 설정되면이 변수는 감소 될 수 있지만 증가되지 않는다. 즉, 경로에서 정책 매핑을 지정하는 인증서가 허용되지 않는 경우, 나중에 인증서로 재정의 하는 것은 불가하다. initial-policy-mapping-inhibit이 설정된 경우 초기 값은 0이고, 그렇지 않은 경우 초기 값은 n+1이다.

7. working_public_key_algorithm   
인증서의 서명을 확인하는 데 사용되는 디지털 서명 알고리즘. working_public_key_알고리즘은 신뢰하는 앵커 정보에서 제공하는 신뢰할 수 있는 공개 키 알고리즘으로부터 초기화된다.

8. working_public_key   
인증서 서명을 확인하는 데 사용되는 공개 키. working_public_key는 신뢰하는 앵커 정보에서 제공하는 신뢰할 수 있는 공개 키로부터 초기화된다.

9. working_public_key_parameters   
현재 공개 키와 관련된 매개 변수로, (알고리즘에 따라) 서명을 확인하는 데 필요할 수 있다. working_public_key_parameters 변수는 신뢰하는 앵커 정보에서 제공하는 신뢰할 수 있는 공개 키 파라미터들로부터 초기화된다.

10. working_issuer_name   
체인의 다음 인증서에 예상되는 발급자 고유이름(DN). working_issuer_name은 신뢰하는 앵커 정보에서 제공하는 신뢰할 수 있는 발급자로 초기화된다. 

11. max_path_length   
이 값은 n으로 초기화되고 경로의 각 자체 발행되지 않은 인증서에 대해 감소되며, CA 인증서의 기본 제약 조건 확장 내에서 경로 길이 제약 조건 필드의 값으로 줄일 수 있다.

초기화 단계가 완료되면 6.1.3에 명시된 기본 인증서 처리 단계를 수행한다.